function Screenleap(){var ao=5322;var bG=5327;var aO=3000;var m=1000;this.DISABLE_CUSTOM_PROTOCOL_AUTO_START=-1;var aP=navigator.userAgent.toLowerCase();this.COOKIE_APP_INSTALLED="__ai";this.COOKIE_API_APP_INSTALLED="__aa";this.isMac=aP.indexOf("mac")>-1;this.isWin=aP.indexOf("windows ")>-1;this.isChrome=aP.indexOf("chrome")>-1;this.isFirefox=aP.indexOf("firefox")>-1;this.isSafari=aP.toLowerCase().indexOf("safari")!=-1&&!this.isChrome;this.isMSIE=aP.indexOf("msie")>-1||aP.indexOf("trident")>-1;this.isMSIE8=navigator.appVersion.indexOf("MSIE 8")>-1;this.hasDotNetFramework=aP.indexOf(".net")!=-1;var o=null;var bd=this.isSafari?aP.substring(aP.indexOf("version")+8,aP.indexOf(" safari")):null;var aR=this.isSafari?bd.split("."):null;var aA=this.isSafari&&(aR.length>=3&&aR[0]>=6&&aR[2]>=3||aR.length>=2&&aR[0]>=6&&aR[1]>=1||aR.length>=1&&aR[0]>=7);var aW=this.isMac?parseFloat(aP.substring(aP.indexOf("mac os x")+9,aP.indexOf(")")).replace(/_/g,".").replace(";","").replace(")","")):null;var bz=aP.indexOf("trident")>-1;var p=Error;p.prototype.getStackTrace=function(){var bK=Array.prototype.slice.call(arguments,0);var bL=this.lineNumber?"line: "+this.lineNumber:"stack: "+this.stack;console.log.apply(console,bK.concat([bL]))};var bk={};bk.log=typeof console!="undefined"&&typeof console.log.bind!="undefined"?console.log.bind(console):typeof console!="undefined"&&typeof console.log!="undefined"?console.log:function(){};this.log=bk;var ay=[];var u=null;var bo=null;var aJ="hpcipbhehomfgjbgnajdhiahhdeeffbg";var bE="";var bw=null;var bF=false;var W=null;var t=null;var bt=null;var l=null;var aG=null;var aK=null;var M=2000;var b=false;var aV=true;var aT=20000;var bI=12000;var aa=null;var al=null;var bv=false;var A=true;var K=null;var C=null;var az=null;var aL=false;var X=null;var br="API";var bB=null;var bJ=null;var R="";var a5="";var ak;var at="";var q="";var bh=null;var bD=null;var z=null;var aB=null;var ab=null;var I=null;var O=null;var aj=null;var ad=function(){bk.log("Reset share session");ap();K=null;C=null;az=null;aL=false;X=null;bB=null;bJ=null;bw=null;bF=false;W=null;t=null;bt=null;l=null;aG=null;M=2000;aK=null;bI=12000;aa=null;al=false;a0();bh=null;bD=null;z=null;aB=null;ab=null;O=null;I=null;aj=null};this.onScreenShareStart=function(){alert("Your screen is now shared.")};this.onPresenterConnect=function(){};this.onScreenShareEnd=function(){alert("Screen share ended.")};this.onViewerConnect=function(bL,bK){};this.onViewerDisconnect=function(bL,bK){};this.onPause=function(){};this.onResume=function(){};this.error=function(bM,bK,bL){if(typeof bL=="undefined"){alert("Error during "+bM+". "+bK)}else{if(bL.status){alert("Error during "+bM+", status code: "+bL.status)}else{if(bL.message){alert("Error during "+bM+": "+bL.message)}else{alert("Error during "+bM+". "+bK)}}}};this.setOptions=function(bK){if(typeof bK!="undefined"){if(typeof bK.webServerBaseUrl!="undefined"){u=bK.webServerBaseUrl}if(typeof bK.presenterAppType!="undefined"){bw=bK.presenterAppType}if(typeof bK.browserMessageUrl!="undefined"){bB=bK.browserMessageUrl}if(typeof bK.usePlugin!="undefined"){bk.log("usePlugin = "+bK.usePlugin);A=bK.usePlugin}if(typeof bK.startingWindowTitle!="undefined"){bo=bK.startingWindowTitle}if(typeof bK.serverEnv!="undefined"){bE=bK.serverEnv;if(bE=="dev"||bE=="stage"){this.downloadForCustomProtocol=function(){br="SCREENLEAP";Q(v()+bu({origin:"SCREENLEAP"}))};this.startUsingCustomProtocolHandler=function(bM,bL,bN){i(bM,bL,bN)}}}if(typeof bK.chromeAppId!="undefined"){aJ=bK.chromeAppId}if(typeof bK.downloadNativeTimeout!="undefined"){M=bK.downloadNativeTimeout}if(typeof bK.origin!="undefined"){br=bK.origin}if(typeof bK.useCustomProtocol!="undefined"){aV=bK.useCustomProtocol}if(typeof bK.showScreenShareStartErrorDelay!="undefined"){bI=bK.showScreenShareStartErrorDelay}if(typeof bK.delayAfterDownloadBeforeCallingCustomProtocolHandler!="undefined"){aT=bK.delayAfterDownloadBeforeCallingCustomProtocolHandler}if(typeof bK.forceDownload!="undefined"){bv=bK.forceDownload}if(typeof bK.setHooks!="undefined"){bK.setHooks({copyLink:bl,copyShareCode:ah,copyInstructions:bc,enableWebRTC:a8,disableWebRTC:n,getWebRTCFrame:P,forceSendEntireImage:aQ})}if(bK.presenterAppType&&bE!="dev"&&bE!="stage"){bk.log=function(bL){ay[ay.length]=bL}}}};this.getUseCustomProtocol=function(){return((aV&&br=="API")||br!="API")&&(this.isMac||this.isWin)};this.useClickOnce=function(){return br=="API"&&this.isMSIE&&this.hasDotNetFramework&&!this.getUseCustomProtocol()};this.getUsePlugin=function(){return A&&!this.getUseCustomProtocol()&&!this.useClickOnce()};this.isBrowserSupportedForExtension=function(){return this.isChrome||this.isFirefox||aA};this.isBrowserSupportedForNative=function(){return !(this.isWin&&this.isMSIE&&!bz)};this.isOSSupportedForNative=function(){return this.isWin||(this.isMac&&(aW>10.5||aW<10.2))};this.getDefaultPresenterAppType=function(){return screenleap.isMac||screenleap.isWin?"NATIVE":screenleap.isChrome?"EXTENSION":"APPLET"};this.isAppInstalled=function(){return b||aF(br=="API"?screenleap.COOKIE_API_APP_INSTALLED:screenleap.COOKIE_APP_INSTALLED)=="true"};this.requiresUserGestureInitiatedDownload=function(bK){return(!bK||bK=="NATIVE")&&screenleap.isMSIE8&&screenleap.getUseCustomProtocol()&&!screenleap.isAppInstalled()};this.checkIsExtensionInstalled=function(bK,bM){if(this.isChrome){var bL=new Image();bL.onload=function(){if(typeof bK=="function"){bK()}};bL.onerror=function(){if(typeof bM=="function"){bM()}};try{bL.src="chrome-extension://"+aJ+"/screenleap_icon_16_16.png"}catch(bN){this.error("checkIsExtensionInstalled","Error checking extension installation.",bN);if(typeof bM=="function"){bM()}}}else{this.checkIsExtensionEnabled(bK,bM)}};this.checkIsExtensionEnabled=function(bK,bM,bO,bL){if(!bO){bO=5}if(!bL){bL=1}var bN=ac();if(bN&&bN.getAttribute("installed")){if(typeof bK=="function"){bK()}}else{if(bL<bO){setTimeout(function(){screenleap.checkIsExtensionEnabled(bK,bM,bO,bL+1)},1000)}else{if(typeof bM=="function"){bM()}}}};this.installExtension=function(bK,bL,bM){if(this.isBrowserSupportedForExtension()){if(this.isChrome){if(!bM){bM=window.location.href}aC(v()+"/install-extension?redirectUrl="+bM);bg(bK)}else{if(this.isFirefox){try{InstallTrigger.install({Screenleap:{URL:v()+"/ext/screenleap"+w()+".xpi"}});bg(bK,bL)}catch(bN){if(typeof bL=="function"){bL("Unexpected supported browser type.")}else{a1("installExtension","Unexpected supported browser type.")}}}else{if(this.isSafari){aC(v()+"/ext/screenleap"+w()+".safariextz");bg(bK)}else{if(typeof bL=="function"){bL("Unexpected supported browser type.")}else{a1("installExtension","Unexpected supported browser type.")}}}}}else{if(typeof bL=="function"){bL("The extension is only available in Chrome, Firefox and some versions of Safari.")}else{a1("installExtension","The extension is only available in Chrome, Firefox and some versions of Safari.")}}};var d=function(){return W!=null};function ai(bK){if(bK&&typeof bK.nativeDownloadStarting=="function"){bh=bK.nativeDownloadStarting}if(bK&&typeof bK.downloadStarting=="function"){bh=bK.downloadStarting}if(bK&&typeof bK.screenShareStarting=="function"){z=bK.screenShareStarting}if(bK&&typeof bK.pluginDisabled=="function"){aB=bK.pluginDisabled}if(bK&&typeof bK.pluginEnabled=="function"){ab=bK.pluginEnabled}if(bK&&typeof bK.appConnectionFailed=="function"){I=bK.appConnectionFailed}if(bK&&typeof bK.screenShareStartError=="function"){O=bK.screenShareStartError}if(bK&&typeof bK.appSwitchoverCompleted=="function"){aj=bK.appSwitchoverCompleted}}this.startSharing=function(bL,bP,bN,bM){bk.log("Starting share with app type "+bL);if(bL&&bL=="DEFAULT"){if(this.isMac){bL="NATIVE"}else{bL="APPLET"}}if(!bL||!ax(bL)){a1("startSharing","Invalid presenterAppType: "+bL);return}if(bP&&!bP.screenShareCode){a1("startSharing","Missing mandatory screen share data.");return}if(bP&&bP.screenShareCode&&!H(bP.screenShareCode)){a1("startSharing","Screen share code is not valid: "+bP.screenShareCode);return}else{if(bL=="NATIVE"){if(!bD&&(!bP.presenterParams||!bP.screenShareCode)){a1("startSharing","Missing required information.");return}else{if(!e()){return}}}else{if(bL=="EXTENSION"){if(!bP.screenShareCode){a1("startSharing","Missing required information.");return}else{if(!this.isBrowserSupportedForExtension()){a1("startSharing","This browser is not supported for the sharing extension.");return}}}else{if(bL=="APPLET"){if(!bP.appletHtml){a1("startSharing","Missing required information.");return}}}}}ad();bw=bL;if(bP){Y(bP)}ai(bN);var bO=bN?bN.redirectUrl:null;var bK=bN?bN.waitingForSafariExtensionToInstall:false;if(bM){this.setOptions(bM)}if(bw=="EXTENSION"){if(bP.startedFromApp){E("startSharing");aY();ba(new Date().getTime())}else{this.checkIsExtensionEnabled(function(){ae("share",bP);a2()},function(){if(bK){}else{if(bE=="dev"&&!this.isSafari){alert("Please install the extension before starting an extension share in dev mode")}else{screenleap.installExtension(function(){ae("share",bP)},function(){a1("startSharing","Unable to install screen sharing extension.")},bO)}}})}}else{if(bw=="NATIVE"){a9(bP)}else{if(bw=="APPLET"){ac().innerHTML=bP.appletHtml}}}};this.startAppUsingCustomProtocolHandler=function(){i(C,az,aL);return false};this.downloadAndStartNativeApp=function(){bv=true;if(K){D(K)}return false};this.getPresenterAppType=function(){return bw};this.getScreenShareCode=function(){return C};this.getViewerUrl=function(){return X};this.isScreenShareStarted=function(){return bt!=null};this.isScreenShareStopped=function(){return C==null};this.stopSharing=function(){if(!bw){this.error("stopSharing","Invalid share state.")}else{if(bw=="NATIVE"||bw=="APPLET"){aD(1,false)}else{if(bw=="EXTENSION"){ae("stop");this.endScreenShare({message:"API_CALL"})}}}};this.pauseSharing=function(){if(bw=="EXTENSION"){a1("pauseSharing","The pause call has not ben implemented for the browser extension.")}else{if(bF){bm("pa",null,function(bK){a1("pause","Error processing pause request",bK)})}else{ag("/pause/"+C,null,function(){bm("pa",null,function(bK){a1("pause","Error processing pause request",bK)})})}}};this.resumeSharing=function(){if(bw=="EXTENSION"){a1("resumeSharing","The resume call has not been implemented for the browser extension.")}else{if(bF){bm("rr",null,function(bK){a1("resume","Error processing resume request",bK)})}else{ag("/resume/"+C,null,function(){bm("rr",null,function(bK){a1("resume","Error processing resume request",bK)})})}}};this.startRecording=function(){if(bJ){bm("rt",null,function(bK){a1("startRecording","Error processing start recording request",bK)})}else{screenleap.error("startRecording","Recording has not been enabled for the screen share.",{})}};this.stopRecording=function(){if(bJ){bm("rp",null,function(bK){a1("stopRecording","Error processing stop recording request",bK)})}else{screenleap.error("stopRecording","Recording has not been enabled for the screen share.",{})}};var bm=function(bM,bK,bL){bk.log("Send call via app server: "+bM);aX("sendApiCallViaAppServer:"+bM,{url:bB+"/"+bM,type:"GET",success:function(bN){if(typeof bK=="function"){bK(bN)}},error:function(bN){if(typeof bL=="function"){bL(bN)}}})};this.endScreenShare=function(bL){if(C){if((bw=="NATIVE"&&this.getUsePlugin())||bw=="APPLET"){ac().innerHTML=""}if(bE=="stage"){bj("End of screen share on staging")}if(bL){this.onScreenShareEnd(bL.message)}else{this.onScreenShareEnd()}ad();U();ay=[];var bK=document.getElementById("hiddenDownloader");if(bK){document.body.removeChild(bK)}}};this.downloadNativeApp=function(bK,bM,bL){ad();if(typeof bK!="function"){a1("downloadNativeApp","You need to pass in onAppDownloadEnd callback function");return}if(!e()){return}bD=bK;ai(bM);if(bL){this.setOptions(bL)}c()};this.startNativeApp=function(bL,bK){Y(bL);ai(bK);bw="NATIVE";bs(bL)};this.startNewShare=function(bL,bM){var bK=window.location.hostname;if(bK.indexOf(".")==-1||bK.substr(bK.indexOf(".")+1).indexOf("screenleap.com")!=0){this.error("This is for internal use only")}else{bw="EXTENSION";ae("newShare",{origin:bL,isCaptureEntireScreen:bM});a2()}};this.startNewBroadcast=function(bL,bM){var bK=window.location.hostname;if(bK.indexOf(".")==-1||bK.substr(bK.indexOf(".")+1).indexOf("screenleap.com")!=0){this.error("This is for internal use only")}else{bw="EXTENSION";ae("newBroadcast",{origin:bL,isCaptureEntireScreen:bM});a2()}};var Y=function(bK){K=bK;C=bK.screenShareCode;az=bK.participantId;aL=bK.isRequestingToBePresenter;bk.log("Extract data for share "+C);X=bK.viewerUrl;br=bK.origin;bB=bK.browserMessageUrl;if(typeof bK.serverEnv!="undefined"){bE=bK.serverEnv}bJ=bK.recordingId};var ac=function(){var bK=document.getElementById("screenleapDiv");if(!bK){bK=document.createElement("div");bK.id="screenleapDiv";bK.setAttribute("style","position:fixed;right:1px;bottom:1px;visibility:hidden;width:1px;height:1px");document.body.appendChild(bK)}return bK};var aE=function(){return document.getElementById("screenleapDiv")};var aw=function(bK){if(bE=="stage"){bk.log(bK)}};var bp=function(bK,bL){if(!bw){if(typeof bL=="function"){bL()}}else{if(bw=="EXTENSION"){a1("statusCheck","This check is not valid for extension shares.")}else{if(bw=="NATIVE"||bw=="APPLET"){aX("checkIsShareActive",{url:bC()+"/status"+(C?"/"+C:""),type:"GET",success:function(bM,bN){G();if(typeof bK=="function"){bK(bM,bN)}},error:function(bN){var bM=false;if(C&&bN){if(bN.status==410){bM=true;aw("got 410 during _doShareStatusCheckByLocalCommunication");screenleap.endScreenShare({message:"LOCKED"})}else{if(bN.status==400){bM=true;a1("checkIsShareActive","Screen share "+C+" is not running.")}}}if(!bM&&bt&&at){bk.log("Local status check failed - but without any informative status, and app server connection is active")}if(typeof bL=="function"){bL(bN)}else{a1("checkIsShareActive","Error checking app for status",bN)}}})}}}};var aD=function(bK,bL){bk.log("Send stop message to native");if(bF){bm(bL?"sa":"sp",null,function(bM){a1("stop","Error processing stop request",bM)})}else{aX("stop",{url:bC()+"/stop/"+C,type:"POST",success:function(bM){bk.log("Send successful stop message: "+bM)},error:function(){bk.log("Stopping share via app server because failed to do so via local web server");bm(bL?"sa":"sp",null,function(bM){if(bM&&bM.status&&bM.status!=400&&bM.status!=403&&bM.status!=410){a1("stop","Error processing stop request as backup to local stop",bM)}screenleap.endScreenShare()})}})}};var aY=function(bK){if(screenleap.getUseCustomProtocol()){au(br=="API"?screenleap.COOKIE_API_APP_INSTALLED:screenleap.COOKIE_APP_INSTALLED,true,365,location.hostname);b=true}if(!bt){bk.log("Screen share started");bt=new Date().getTime();screenleap.onScreenShareStart(bK);if(screenleap.getUseCustomProtocol()){a0()}}};var bs=function(bK){bk.log("Send start message to presenter app");if(z){z()}setTimeout(function(){var bL="/start?presenterParams="+bK.presenterParams;if(bo){bL+="&startingWindowTitle="+bo}L(bL,bx)},m)};var aC=function(bK){window.location.href=bK};var h=function(bM,bK){var bL=document.getElementById(bM);if(!bL){bL=document.createElement("iframe");bL.id=bM;bL.style.display="none";document.body.appendChild(bL)}bL.src=bK};var Q=function(bK){if(screenleap.isMSIE8){window.location.href=bK}else{h("hiddenDownloader",bK)}};var c=function(bK){bk.log("Download native app");if(bh){bh(screenleap.startAppUsingCustomProtocolHandler)}if(M&&!screenleap.useClickOnce()&&!screenleap.isMSIE8){setTimeout(function(){D(bK)},M)}else{D(bK)}};var D=function(bK){if(!screenleap.isMSIE8||screenleap.useClickOnce()||!bK||bv){Q(v()+bu(bK))}bv=false;if(screenleap.getUsePlugin()&&bK){af(function(){F(bK)});return}if(screenleap.isMSIE8&&!bK&&bD){bD()}else{if(screenleap.getUseCustomProtocol()&&bK){if(!bF){bs(bK)}}else{if(screenleap.useClickOnce()&&bK){k()}else{bA(bD)}}}};var bA=function(bK){if(!bF){L("/status",function(){G();if(bK){bK()}})}else{bk.log("No local communication alternative for listening for app start.")}};var E=function(bK){if(!bF){bk.log(bK+": bypass local communication")}bF=true};var G=function(){if(!W){bk.log("Local communication started")}W=new Date().getTime();J(W);if(aK){aK=null}};var a6=function(){return ak&&W?new Date().getTime()-W<2000:false};var Z=function(){if(!t){bk.log("App server communication started")}t=new Date().getTime();J(t);if(aK){aK=null}};var a=function(){return at&&t?new Date().getTime()-t<120000:false};var a7=function(){return t};var J=function(bK){aG=bK?bK:new Date().getTime()};var s=function(){return aG?(new Date().getTime()-aG)/1000:0};var V=function(){return aK?(new Date().getTime()-aK)/1000:0};var w=function(){if(bE=="dev"||bE=="stage"){return"_"+bE}else{return""}};var bu=function(bM){var bL=bM&&bM.origin?bM.origin:br;if(screenleap.isMac){return"/share/mac?browser=true&origin="+bL+"&isInitialInstallation="+!screenleap.isAppInstalled()+"&screenShareCode="+bM.screenShareCode}else{if(screenleap.useClickOnce()&&bM){var bK=(bL=="SCREENLEAP"?"Screenleap":"ScreenShare")+(bE?"_"+bE.charAt(0).toUpperCase()+bE.slice(1):"");return"/public/windows/"+bK+"/"+bK+".application?presenterParams="+encodeURIComponent(bM.presenterParams)}else{return"/share/win?origin="+bL+"&clickOnce="+screenleap.useClickOnce()+"&standard="+(screenleap.getUsePlugin()||screenleap.getUseCustomProtocol())+"&isInitialInstallation="+!screenleap.isAppInstalled()+(bM?"&screenShareCode="+bM.screenShareCode:"")}}};var g=function(bK){bk.log("Download and start native app");if(!bK||!bK.alreadyDownloaded){c(bK)}};var f=function(bK){if(screenleap.getUsePlugin()&&bq()&&ac()){if(!an()){a3()}F(bK)}else{g(bK)}};var a9=function(bK){bk.log("Start native app");if(bK.startedFromApp){bk.log("Started by mac app");G();bx()}else{if(screenleap.getUseCustomProtocol()&&!aa){if(screenleap.isAppInstalled()){am(bK)}else{N(bK)}}else{if(screenleap.isMac){be(function(){G();bs(bK)},function(){f(bK)})}else{f(bK)}}}};var e=function(){if(!screenleap.isBrowserSupportedForNative()){screenleap.error("startSharing","This browser is not supported for the native sharing app.",{message:"BROWSER_NOT_SUPPORTED"});return false}else{if(!screenleap.isOSSupportedForNative()){screenleap.error("startSharing","This OS is not supported for the native sharing app.",{message:"OS_NOT_SUPPORTED"});return false}}return true};var be=function(bK,bL){aX("checkIsMacAppRunning",{url:bC()+"/status",type:"POST",success:bK,error:bL})};var bC=function(){if(!o){var bK=screenleap.isMac||window.location.protocol=="https:";o=(bK?"https:":"http:")+"//0111001101101100.com:"+(bK?"5327":"5322")}return o};var av=function(bL,bK,bM){return(br=="API"?"screenshare":"screenleap")+(bE&&screenleap.isWin?bE:"")+(screenleap.isSafari?"://":":")+bL+(bK?"?p="+bK:"")+(bM?"&r=true":"")};var S=function(){return window.location.host.indexOf("screenleap.com")!=-1};var v=function(){return u?u:bn()};var bn=function(){return S()?"":window.location.protocol+"//"+(bE=="stage"?"stage":"www")+".screenleap.com"};var bH=function(bM,bL){bk.log(bL+": Process "+bM);try{var bO=JSON.parse(bM);for(var bK=0;bK<bO.length;bK++){if(C){aI(bO[bK])}}}catch(bN){}};var aI=function(bL){switch(bL.type){case"ss":aY(bL);break;case"sc":if(!l){aY(bL);l=new Date().getTime();screenleap.onPresenterConnect(bL)}break;case"se":if(bL.message&&bL.message=="LOST_CONNECTION"){bj("RECEIVED LOST_CONNECTION FROM POLLING RESPONSE");aw("RECEIVED LOST_CONNECTION FROM POLLING RESPONSE")}else{aw("_processResponse got se")}ag("/ack-se/"+C);screenleap.endScreenShare(bL);break;case"cn":screenleap.onViewerConnect(bL.participantId,bL.externalId,bL.useWebRTC);break;case"dn":screenleap.onViewerDisconnect(bL.participantId,bL.externalId,bL.useWebRTC);break;case"sp":screenleap.onPause();break;case"sr":screenleap.onResume();break;case"sa":var bK=(bB.charAt(4)=="s"?"https://":"http://")+bL.hostname+bB.substring(bB.indexOf("/",bB.indexOf("screenleap.com")));bk.log("Switching app servers to "+bK);bB=bK;if(aj){aj(bK)}break;default:if(S()&&typeof screenleap.processResponse=="function"){screenleap.processResponse(bL)}break}};var ax=function(bK){return bK=="EXTENSION"||bK=="NATIVE"||bK=="APPLET"};var ae=function(bN,bL){if(bL){bL.action=bN}else{bL={action:bN}}if(!bL.origin){bL.origin=br}var bM=ac();if(bM){var bK=document.createEvent("CustomEvent");bK.initCustomEvent("screenleapTrigger",true,true,bL);bM.dispatchEvent(bK)}};this.processWebPageMessage=function(bK){aI(bK);return true};var aU=function(bL){var bK=bL.detail;if(bK){switch(bK.event){case"screenShareStarted":screenleap.onScreenShareStart(bK);break;case"screenShareStartFailed":screenleap.error("startSharing","Unable to start share",{status:bK.status});break;case"webPageMessage":screenleap.processWebPageMessage(bK);break;case"viewerConnected":screenleap.onViewerConnect(bK.participantId,bK.externalId);break;case"viewerDisconnected":screenleap.onViewerDisconnect(bK.participantId,bK.externalId);break;case"screenShareStopped":screenleap.endScreenShare(bK);break;case"screenShareEnd":screenleap.onScreenShareEnd();break;default:bk.log("unknown message from extension: "+bK.event)}}};var a2=function(){if(bw=="EXTENSION"){var bK=aE();if(bK){bK.addEventListener("screenleapExtensionEvent",aU)}}};var U=function(){if(bw=="EXTENSION"){var bK=aE();if(bK){bK.removeEventListener("screenleapExtensionEvent",aU)}}};var L=function(bL,bK,bM){if(!bM){bM=0}ag(bL,bK,function(bN){if(!C){return}if(bN&&bN.status==409){aw("Conflict 409");screenleap.endScreenShare({message:"CONFLICT"})}else{if(bN&&bN.status==400){aw("Conflict 400");screenleap.endScreenShare({message:"CONFLICT"})}else{setTimeout(function(){L(bL,bK,++bM)},m)}}})};var bl=function(bK,bL){if(bw=="EXTENSION"){ae("sendMessageFromWebPage",{message:"cl"});bK()}else{if(d()){ag("/copy-link",bK,bL)}else{bm("cl",bK,bL)}}};var ah=function(bK,bL){if(bw=="EXTENSION"){ae("sendMessageFromWebPage",{message:"cs"});bK()}else{if(d()){ag("/copy-share-code",bK,bL)}else{bm("cs",bK,bL)}}};var bc=function(bL,bK,bM){if(bw=="EXTENSION"){ae("sendMessageFromWebPage",{message:"cc|"+bL});bK()}else{if(d()){ag("/copy-instructions/"+bL,bK,bM)}else{bm("cc|"+bL,bK,bM)}}};var a8=function(bK,bL){if(d()){ag("/webrtc-enable",bK,bL)}};var n=function(bK,bL){if(d()){ag("/webrtc-disable",bK,bL)}};var P=function(bM,bK,bL){if(d()){ag("/frame",bK,bL,bM,"arraybuffer")}};var aQ=function(bK,bL){if(d()){ag("/force-send",bK,bL)}};var ag=function(bN,bK,bL,bO,bM){aX("sendMessageToNativeApp",{url:bC()+bN,type:"POST",params:bO,responseType:bM,success:function(bP,bQ){G();if(typeof bK=="function"){bK(bP,bQ)}},error:function(bP){if(typeof bL=="function"){bL(bP)}}})};var H=function(bK){if(!bK){return false}else{bK=""+bK;bK=bK.replace(/ /g,"");return bK&&bK.length==9&&/^[0-9]+$/.test(bK)}};var aS=function(){return"withCredentials" in new XMLHttpRequest()};var aX=function(bN,bM){var bP;if(bM.params){bM.url+="?";for(var bK in bM.params){bM.url+=bK+"="+encodeURIComponent(bM.params[bK])+"&"}bM.url=bM.url.slice(0,bM.url.length-1)}if(!bM.type){bM.type="GET"}if(bM.type=="GET"){bM.url+=(bM.url.indexOf("?")==-1?"?ts=":"&ts=")+new Date().getTime()}if(aS()){bP=new XMLHttpRequest();bP.open(bM.type,bM.url,true);bP.timeout=bM.timeout?bM.timeout:aO;if(bM.responseType){bP.responseType=bM.responseType}if(bM.data){bP.setRequestHeader("Content-type",bM.contentType||"application/x-www-form-urlencoded")}if(bM.headers){for(var bL in bM.headers){bP.setRequestHeader(bL,bM.headers[bL])}}bP.onreadystatechange=function(){if(bP.readyState==4){if(bP.status==200){if(bM.success){bM.success(bP.responseType?null:bP.responseText,bP)}}else{if(bM.error){bM.error(bP)}}bP=null}};try{bP.send(bM.data?bM.data:null)}catch(bO){a1(bN,"Encountered exception while calling send for url "+bM.url+": "+bO);if(bM.error){bM.error(null)}}}else{if(typeof XDomainRequest!="undefined"){bM.url+=(bM.url.indexOf("?")==-1?"?":"&")+"returnOkWithStatus=true";bP=new XDomainRequest();bP.open(bM.type||"GET",bM.url);bP.onload=function(){if(bP.responseText){var bQ;try{bQ=JSON.parse(bP.responseText)}catch(bR){bk.log(bN+": failed to parse response "+bP.responseText)}if(bQ&&bQ.status&&bQ.status!=200){if(bM.error){bM.error({status:bQ.status,reason:bQ.reason})}bP=null;return}}if(bM.success){bM.success(bP.responseText)}bP=null};bP.onerror=function(){if(bM.error){bM.error()}bP=null};bP.ontimeout=function(){if(bM.error){bM.error()}bP=null};bP.onprogress=function(){};bP.timeout=bM.timeout?bM.timeout:aO;setTimeout(function(){bP.send(bM.data)},0)}}};var y=function(){if(screenleap.isMac&&(aP.indexOf("chrome/39")!=-1||aP.indexOf("chrome/4")!=-1)){return"application/x-screenleap-x86_64-1-plugin"}return screenleap.isWin?"application/x-screenleap"+(bE?"-"+bE:"")+"-1":"application/x-screenleap-1-plugin"};var bq=function(){navigator.plugins.refresh(false);var bN=false;var bK=navigator.plugins;var bM=y();for(var bL=0;bL<bK.length;bL++){if(screenleap.isWin){if(bK[bL][0]){var bO=bK[bL][0];if(bO.type==bM){bN=true;bk.log("Found "+bO.type+" plugin");break}}}else{if(screenleap.isMac&&(aP.indexOf("chrome/39")!=-1||aP.indexOf("chrome/4")!=-1)&&bK[bL].name&&bK[bL].description=="Screenleap Plugin (x86_64) 1.0.0"){bN=true;break}else{if(bK[bL].name&&bK[bL].description=="Screenleap Plugin 1.0.0"){bN=true;break}}}}bk.log(bN?"Plugin is installed":"Plugin is not installed");return bN};var a3=function(){bk.log("Make plugin obj");ac().innerHTML="";navigator.plugins.refresh(false);a4()};var a4=function(){ac().innerHTML='<object id="screenleapPluginObj" type="'+(y())+'" style="width:1px;height:1px"></object>'};var an=function(){return document.getElementById("screenleapPluginObj")};var j=function(bL,bM,bK){if(R){if(R==bL){if(a5!=bM){a1(bL,"This action is already running. Try reloading the page for a fresh state.")}}else{a1(bL,"Unable to run this action at the same time as "+R)}}else{R=bL;a5=bM;ak=bK?bK:false;bk.log("Started poll "+a5+":"+R)}};var bf=function(bK){if(!bK||R==bK||a5==bK){bk.log("Stopped poll"+(a5?" "+a5+":"+R:""));R="";a5=""}else{if(a5||R){bk.log(bK+": Ignoring request to end poll because current poll is "+a5+":"+R)}}};var ap=function(){bf();ak=false;at="";q=""};var x=function(bK){if(ak&&bF){bf(bK);bk.log("Bypassing local communication - turn off poll "+R)}return a5==bK};var bg=function(bK,bL){var bM=new Date().getTime();j("waitForExtensionInstallation",bM);aZ(bK,bL,bM)};var aZ=function(bK,bL,bM){if(x(bM)){setTimeout(function(){screenleap.checkIsExtensionInstalled(function(){bf(bM);if(typeof bK=="function"){bK()}},function(){setTimeout(function(){aZ(bK,bL,bM)},500)})},1000)}else{if(typeof bL=="function"){bL("Aborted waiting for extension installation.")}}};var k=function(){if("EXTENSION"==bw){bk.log("ERROR: _waitForShareShareStart should not be called for extensions");return}bk.log("Start polling for share start");if(!aK){aK=new Date().getTime()}if(!bF){var bK=new Date().getTime();j("waitForShareStart",bK,true);aM(bK)}setTimeout(function(){ba(new Date().getTime())},500)};var aM=function(bK){if(x(bK)){bp(function(bL){bf(bK);if(bL){bH(bL,"_pollForShareStartByLocalCommunication")}if(C){bk.log("Poll for share start successful");bx()}},function(bL){setTimeout(function(){if(bL&&bL.status==400){bf(bK)}else{aM(bK)}},1000)})}};var bx=function(){aY();bk.log("Start polling for share end");if(!bF){bf("waitForShareStart");j("waitForShareEnd",C,true);ar(C)}ba(new Date().getTime())};var ar=function(bK){if(x(bK)){bp(function(bM){var bL=false;G();if(bM){bk.log("Received message: "+bM);bL=bH(bM,"_pollForShareEndByLocalCommunication")}if(!bL&&C){setTimeout(function(){ar(bK)},1000)}else{bk.log("Share ended; stop polling");bf(bK)}},function(bL){if(bL&&(bL.status==404||bL.status==400)){bf(bK);aw("_pollForShareEndByLocalCommunication got "+bL.status+", so stopping share.");screenleap.endScreenShare()}else{if(s()>30){bk.log("Lost local connection over 30s ago; switch to app server polling.");bf(bK);E("_pollForShareEndByLocalCommunication");ba(new Date().getTime())}else{if(!bF){bk.log("Lost local connection");setTimeout(function(){ar(bK)},1000)}else{bk.log("Ignoring failed local poll because bypass is active.")}}}})}else{bk.log("Stop polling local webserver for share end; poll cancelled")}};var am=function(bK){bk.log("using custom protocol handler");aa=new Date().getTime();bb(bK,true)};var i=function(bM,bL,bN){var bK=av(bM,bL,bN);bk.log("Attempting to start app using custom protocol handler...");if(z){z()}if(screenleap.isMSIE8){setTimeout(function(){window.location.assign(bK)},500)}else{if(screenleap.isChrome){window.location.assign(bK)}else{a0();h("screenleapCustomProtocol",bK)}}};var a0=function(){if(document.getElementById("screenleapCustomProtocol")){document.body.removeChild(document.getElementById("screenleapCustomProtocol"));return true}return false};var bb=function(bL,bK){bk.log("pollForCustomProtocolHandlerStart");k();if(!screenleap.isScreenShareStarted()&&!screenleap.isScreenShareStopped()){if(bv){N(bL)}else{if(!screenleap.isAppInstalled()&&bK){N(bL)}else{i(bL.screenShareCode,bL.participantId,bL.isRequestingToBePresenter);setTimeout(function(){if(!bt&&O){O()}},bI)}}}};var N=function(bK){g(bK);if(aT!=screenleap.DISABLE_CUSTOM_PROTOCOL_AUTO_START){setTimeout(function(){bb(bK,false)},aT)}};var af=function(bK){if(!bL){var bL=new Date().getTime();j("waitForPluginInstallation",bL);if(!bq()&&!an()){a3()}aN(bK,bL)}};var aN=function(bK,bL){if(x(bL)){if(!bq()){setTimeout(function(){aN(bK,bL)},2000)}else{bf();bK()}}};var F=function(bL){if(!q){bk.log("Start app via plugin with share code "+C);a3();var bK=new Date().getTime();q=bK;T(bL,bK,true)}};var T=function(bO,bN,bL){if(q&&q==bN){a4();var bM=an();if(typeof bM.start=="undefined"){if(bL&&aB){aB()}setTimeout(function(){T(bO,bN)},2000)}else{if(!bL&&ab){ab()}bk.log("start by plugin");var bK=bM.start(screenleap.isWin?"-pp "+bO.presenterParams:bO.presenterParams);if(bK=="success"){if(z){z()}q="";bk.log("Plugin start success");k()}else{if(bK=="init-failure"){setTimeout(function(){T(bO,bN,bL)},1000)}else{q="";a1("[start by plugin]","Attempt to start Screenleap via the plugin was unsuccessful ["+bK+"]. Turning off usePlugin.");screenleap.setOptions({usePlugin:false});g(bO)}}}}};var aq=function(){return bt?new Date().getTime()-bt:0};var ba=function(bL,bK){if(C&&bB&&(bF||!d())){if(!at||at==bL){if(!at){at=bL;bk.log("Start polling app server: "+at)}by(function(bM){Z();bH(bM,"_pollAppServerForMessages");if(!bF&&!d()){if(aq()>500){E("_pollAppServerForMessages")}}setTimeout(function(){ba(bL)},1000)},function(bN){if(bN&&bN.status=="400"){setTimeout(function(){ba(bL)},1000)}else{if(bN&&bN.status=="404"){if(bw=="NATIVE"&&screenleap.getUsePlugin()&&bL<new Date().getTime()-15000){screenleap.error("startSharing","We were unable to start your screen share. This can sometimes happen if you start a new share immediately after ending another one. Please wait 10 seconds and try sharing again.");if($("#nativeStarting").is(":visible")){$("#nativeStarting").fadeOut(function(){screenleap.endScreenShare()})}else{screenleap.endScreenShare()}}setTimeout(function(){ba(bL)},1000)}else{if(bN&&bN.status=="410"){at="";bk.log("Stop polling app server; share ended");aw("Stop polling app server; share ended");screenleap.endScreenShare({message:"LOCKED"})}else{if(bK){if(s()>480){bk.log("Connection lost. Ending.");bj("ENDING SHARE DUE TO LOST CONNECTION");var bM=s();aw("ENDING SHARE DUE TO LOST CONNECTION, seconds since last app message: "+(bM?bM:"never received app message"));screenleap.endScreenShare({message:"LOST_CONNECTION"})}else{if(V()>30&&typeof I=="function"){I()}setTimeout(function(){ba(bL,bK)},1000)}}else{if(s()>300){setTimeout(function(){ba(bL,true)},1000)}else{setTimeout(function(){ba(bL)},1000)}}}}}},bK)}}else{at="";bk.log("Stop polling app server")}};var by=function(bK,bM,bL){aX("makeAppServerRequest",{url:bB+(!aG||!bt||bL?"?isStart=true":""),type:"GET",timeout:60000,success:function(bN){if(typeof bK=="function"){bK(bN)}},error:function(bN){if(typeof bM=="function"){bM(bN)}}})};var aH=function(){var bL="";var bM=ay;ay=[];for(var bK=0;bK<bM.length;bK++){bL+=bM[bK]+"\n"}return bL};var bj=function(bK){var bL=B();bL.error=bK;aX("emailErrorReport",{url:bn()+"/screen-share/log-js-email",params:bL,data:aH(),type:"POST"})};var B=function(){return{userAgent:aP,usePlugin:A,presenterAppType:bw,localCommunicationStarted:a6(),appServerPollingStarted:a7(),localShareStartTime:bt,presenterConnectTime:l,lastAppMessageTimestamp:aG,screenShareCode:C,participantId:az,isRequestingToBePresenter:aL,serverEnv:bE,pollingAction:R,appServerPollId:at,pluginStartPollId:q,useClickOnce:screenleap.useClickOnce(),isMac:screenleap.isMac,isWin:screenleap.isWin}};var bi=function(){var bK=new Date();var bL=(bK).toTimeString();return bK.getFullYear()+"-"+bK.getMonth()+"-"+bK.getDate()+" "+bL.substring(0,bL.lastIndexOf(":")+3)+":"+bK.getMilliseconds()};var a1=function(bM,bL,bK){bj(bM+": "+bL+(bK&&bK.message?" - "+bK.message:"")+(bK&&bK.status?"; status code "+bK.status:""));screenleap.error(bM,bL,bK)};var au=function(bL,bP,bM,bN){var bK="";if(bM){var bO=new Date();bO.setTime(bO.getTime()+(bM*24*60*60*1000));bK="expires="+bO.toUTCString()}document.cookie=bL+"="+bP+(bK?"; "+bK:"")+(bN?"; domain="+bN+"; path=/":"")};var aF=function r(bM){var bL=bM+"=";var bK=document.cookie.split(";");for(var bN=0;bN<bK.length;bN++){var bO=bK[bN];while(bO.charAt(0)==" "){bO=bO.substring(1)}if(bO.indexOf(bL)!=-1){return bO.substring(bL.length,bO.length)}}return""}}var screenleap=screenleap||new Screenleap();var screenleapShareCodeFieldAllowHandle=true;function screenleapShareCodeFieldKeyUp(d,c){if(typeof isAndroid!="undefined"&&isAndroid){return true}d=d?d:window.event;var a=window.event?d.keyCode:d.which;if(!d.ctrlKey&&!d.altKey&&!d.shiftKey&&(a>=33&&a<=40)){return true}if(c.value.length>0){var b=/^[0-9 ]+$/.test(c.value);if(d.keyCode==8){while(c.value.length>0&&c.value.charAt(c.value.length-1)==" "){c.value=c.value.substring(0,c.value.length-1)}return true}else{if(d.keyCode==13&&((screenleapShareCodeFieldAllowHandle&&!b)||c.value.length==13)){return true}}c.value=formatScreenleapShareCode(c.value)}return false}function formatScreenleapShareCode(e,f){var b=[];var d=0;if(!f){f=getScreenleapShareCodeSeparator(e)}if(!screenleapShareCodeFieldAllowHandle){e=e.replace(/\D/g,"")}var a=/^[0-9 ]+$/.test(e);if(a){for(var c=0;c<e.length;c++){if(e.charAt(c)!=" "){b.push(e.charAt(c));d++;if(d>0&&d<9&&d%3==0){b.push(f)}else{if(d==9){break}}}}var g=b.join("");if(e!=g){return g}}return e}function getScreenleapShareCodeSeparator(c){var d="";var b=false;for(var a=0;a<c.length;a++){if(c.charAt(a)==" "){b=true;d+=" "}else{if(b){return d}}}return d==""?"  ":d};
